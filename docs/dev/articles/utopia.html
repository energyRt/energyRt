<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Utopia: the testing model • energyRt</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Utopia: the testing model">
<meta property="og:description" content="energyRt">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-CYBYJ238Q5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CYBYJ238Q5');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">energyRt</a>
        <span class="version label label-info" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.01.20.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/utopia.html">Utopia: the testing model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/energyRt/energyRt/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="utopia_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="utopia_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="utopia_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Utopia: the testing model</h1>
            <h3 class="subtitle">energyRt: making energy systems modeling as simple as linear regression in R</h3>
                        <h4 class="author">Oleg Lugovoy, Vladimir Potashnikov</h4>
            
            <h4 class="date">2020-12-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/energyRt/energyRt/blob/master/vignettes/utopia.Rmd"><code>vignettes/utopia.Rmd</code></a></small>
      <div class="hidden name"><code>utopia.Rmd</code></div>

    </div>

    
    
<div style="page-break-after: always;"></div>
<div id="intoduction" class="section level1">
<h1 class="hasAnchor">
<a href="#intoduction" class="anchor"></a>Intoduction</h1>
<p>This tutorial demonstrates the application of <code>energyRt</code> package to develop a <strong>Reference Energy System</strong> (RES, or <strong>Energy system optimization</strong>) model and conduct standard analysis, i.e. run scenarios, optimize several alternative development pathways of the simplified energy system. The initial (base-year) structure of the discussed below example of RES is flexible. The following features can be easily adjusted:<br>
* number of regions and the model GIS-info (the <em>map</em>),<br>
* the model horizon and annual time-steps (“milestone years”),<br>
* number and levels of sub-annual time-steps (“time slices”),<br>
* technological options, commodities, storage, supply, and demand,<br>
* interregional trade and trade with the rest of the world (ROW),<br>
* constraints on the model variables.</p>
<p>The <code>energyRt</code> package provides a set of S4 classes, methods, and functions to design the model elements, such as technologies, commodities, supply, demand, and constraints, save them in a <code>model</code> object, process the data and save it in a format readable by solver-software (GAMS, GLPK/Mathprog, Python/Pyomo, or Julia/JuMP), run the model code in the solver-software, read the results back to R, and manipulate the data to produce charts and tables.</p>
<p>This Vignette tutorial can be acquired from the <code>energyRt/vignetts</code> folder (or <a href="https://github.com/energyRt/energyRt/vignettes" class="uri">https://github.com/energyRt/energyRt/vignettes</a>). It can be run step-by-step or at once to reproduce the results below. Playing with parameters and data is highly recommended for learning the package and the RES-models. This is the first beta-version of the package and the tutorial. Please report bugs, issues, thoughts here: <a href="https://github.com/energyRt/energyRt/issues" class="uri">https://github.com/energyRt/energyRt/issues</a>.</p>
</div>
<div id="prerequisites" class="section level1">
<h1 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h1>
<p>We assume that <code>R</code> (<a href="https://www.r-project.org/" class="uri">https://www.r-project.org/</a>) and <code>RStudio</code> (<a href="https://www.rstudio.com/" class="uri">https://www.rstudio.com/</a>) has been already installed, and a scholar has some basic knowledge of <code>R</code>. The next step is to have installed <code>energyRt</code>, the solver software (<code>GAMS</code> or <code>GLPK</code>) and <code>LaTeX</code>. The detailed installation steps are available on the package website (<a href="https://github.com/energyRt/energyRt/" class="uri">https://github.com/energyRt/energyRt/</a>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Choose your solver-software</span>
<span class="va">mysolver</span> <span class="op">&lt;-</span> <span class="st">"GLPK"</span>
<span class="co"># mysolver = "JuMP"</span>
<span class="va">mysolver</span> <span class="op">&lt;-</span> <span class="st">"Pyomo"</span>
<span class="va">mysolver</span> <span class="op">&lt;-</span> <span class="st">"GAMS"</span>

<span class="kw">if</span> <span class="op">(</span><span class="cn">T</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Installation of required packages - if not installed.</span>
  <span class="va">mypks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># General tools, data handling, visualisation</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"devtools"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"tidyverse"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"lubridate"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"lubridate"</span><span class="op">)</span>
  <span class="co"># energyRt</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"energyRt"</span><span class="op">)</span><span class="op">)</span> <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"olugovoy/energyRt"</span><span class="op">)</span>
  <span class="co"># GIS tools</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"rgeos"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"rgeos"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"rgdal"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"rgdal"</span><span class="op">)</span>
  <span class="co"># if (!any(mypks == "gpclib")) install.packages("gpclib")</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"spdep"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"spdep"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"maptools"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"maptools"</span><span class="op">)</span>
  <span class="co"># Reporting</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"scales"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"scales"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">mypks</span> <span class="op">==</span> <span class="st">"kableExtra"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"kableExtra"</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Load required packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/energyRt/energyRt">energyRt</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>

<span class="co"># Set color palette for figures</span>
<span class="co"># palette(RColorBrewer::brewer.pal(11, "Paired"))</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html">palette</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">11</span>, <span class="st">"Set3"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="utopia-map" class="section level1">
<h1 class="hasAnchor">
<a href="#utopia-map" class="anchor"></a>Utopia map</h1>
<p>Let’s start with a multi-region map for the model. Below we use GIS info of this imaginary country for visualization of results and also to calculate some parameters for renewables, like solar radiation, and distances between regions. Several options of 11-region map with arbitrary GIS info is saved in <code>energyRt/data</code> folder and compared on the figure below.</p>
<div id="available-options" class="section level2">
<h2 class="hasAnchor">
<a href="#available-options" class="anchor"></a>Available options</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">maps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"utopia_island"</span>, <span class="st">"utopia_continent"</span>, <span class="st">"utopia_squares"</span>, <span class="st">"utopia_honeycomb"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">gis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">maps</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># load map</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gis</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">gis</span><span class="op">)</span>, main <span class="op">=</span> <span class="va">maps</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, bg <span class="op">=</span> <span class="st">"aliceblue"</span><span class="op">)</span>
  <span class="va">cn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCenters.html">get_labpt_spdf</a></span><span class="op">(</span><span class="va">gis</span><span class="op">)</span> <span class="co"># get coordinates of the regions' centers</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">cn</span><span class="op">$</span><span class="va">x</span>, <span class="va">cn</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="figure">
<img src="utopia_files/figure-html/utopia_maps_figure-1.png" alt=""><p class="caption">Map options for Utopia models, up to 11 regions.</p>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">gis</span>, list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"utopia_"</span><span class="op">)</span><span class="op">)</span> <span class="co"># clean-up</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># reset graphical parameters</span></code></pre></div>
<p>Certainly, any other map in <code>SpatialPolygonsDataFrame</code> (spdf) format and with saved names of regions in <code>@data$region</code> column of the spdf object can be used instead. For this particular example lets pick <code>utopia_honeycomb</code> map and keep the <code>7</code> first regions for the simulation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"utopia_honeycomb"</span><span class="op">)</span> <span class="co"># , package = "energyRt")</span>
<span class="va">gis</span> <span class="op">&lt;-</span> <span class="va">utopia_honeycomb</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">utopia_honeycomb</span><span class="op">)</span>
<span class="va">gis</span> <span class="op">&lt;-</span> <span class="va">gis</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="op">]</span>
<span class="co"># gis &lt;- gis[-c(8:9),]</span>

<span class="co"># Often used parameters</span>
<span class="op">(</span><span class="va">reg_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">gis</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="co"># Region names</span>
<span class="op">(</span><span class="va">nreg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">reg_names</span><span class="op">)</span><span class="op">)</span> <span class="co"># Number of regions</span>
<span class="va">reg_centers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCenters.html">getCenters</a></span><span class="op">(</span><span class="va">gis</span><span class="op">)</span> <span class="co"># Coordinates of the regions' centers</span>
<span class="co"># rownames(reg_centers) &lt;- reg_centers$region</span>

<span class="kw">if</span> <span class="op">(</span><span class="cn">F</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Basic map - skipped</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gis</span>,
    col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">gis</span><span class="op">)</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Utopia"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">gis</span><span class="op">)</span>, <span class="st">"regions"</span><span class="op">)</span>,
    bg <span class="op">=</span> <span class="st">"aliceblue"</span>
  <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">reg_centers</span><span class="op">$</span><span class="va">x</span>, <span class="va">reg_centers</span><span class="op">$</span><span class="va">y</span>, labels <span class="op">=</span> <span class="va">reg_names</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">gis</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="mapping-with-ggplot" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-with-ggplot" class="anchor"></a>Mapping with ggplot</h2>
<p>Further we will rely on <code>ggplot</code> package for figures and maps, which requires the intput data in <code>data.frame</code> format, here are the required conversions and the final map.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Converting spdf to data.frame</span>
<span class="va">ggis</span> <span class="op">&lt;-</span> <span class="va">gis</span> <span class="op">%&gt;%</span>
  <span class="fu">fortify</span><span class="op">(</span>region <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">ggis</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># geom_polygon(aes(fill = id), colour = "white", size = 1) +</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set3"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Region"</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Utopia"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">gis</span><span class="op">)</span>, <span class="st">"regions"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">reg_centers</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">region</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="utopia_files/figure-html/Utopia_map_ggplot-1.png" alt=""><p class="caption">The selected map for the Utopia model using ggplot.</p>
</div>
</div>
</div>
<div id="sub-annual-time-resolution" class="section level1">
<h1 class="hasAnchor">
<a href="#sub-annual-time-resolution" class="anchor"></a>Sub-annual time resolution</h1>
<p>Here are examples of sub-annual time hierarchy (time-slices or <code>slices</code>), from one to four levels. The number of levels and their names are flexible (except the upper ‘ANNUAL’ level). The names of the levels are important, they are used as key-words in the definition of commodities and technologies.</p>
<div id="annual-default" class="section level2">
<h2 class="hasAnchor">
<a href="#annual-default" class="anchor"></a>Annual (default)</h2>
<p>For some models, sub-annual time granularity is not needed and can be dropped. This also assumed by default, if slices are not specified, the model will have the annual resolution. Though we can also define this for demonstration of the time-level structures.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 1 time slice - ANNUAL</span>
<span class="va">timeslices1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  ANNUAL <span class="op">=</span> <span class="st">"ANNUAL"</span> <span class="co"># This level should present in every time-slices structure</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="seasons-and-typical-hours" class="section level2">
<h2 class="hasAnchor">
<a href="#seasons-and-typical-hours" class="anchor"></a>Seasons and typical hours</h2>
<p>We can add more levels - seasons or months, weeks, and hours. They should be saved in nested lists. Here is an example with seasons (Winter, Summer, spRing, Autumn), and hours (Day, Night, Peak). The first element in each list is the share of this particular slice in the level. The sum of shares on each level should be equal to one.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 4x3 = 24 slices</span>
<span class="va">timeslices2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  ANNUAL <span class="op">=</span> <span class="st">"ANNUAL"</span>, <span class="co"># required</span>
  <span class="co"># SEASON = c(W = list(1/4,</span>
  <span class="co"># For consistency with other structures, lets rename SEASON to MONTH</span>
  MONTH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span>, <span class="co"># share of the Winter season in the year</span>
      HOUR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        D <span class="op">=</span> <span class="fl">9</span> <span class="op">/</span> <span class="fl">24</span>, <span class="co"># share of day-hours in Winter</span>
        N <span class="op">=</span> <span class="fl">12</span> <span class="op">/</span> <span class="fl">24</span>, <span class="co"># share of night-hours in Winter</span>
        P <span class="op">=</span> <span class="fl">3</span> <span class="op">/</span> <span class="fl">24</span>
      <span class="op">)</span>
    <span class="op">)</span>, <span class="co"># share of peak hours in Winter</span>
    R <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span>, <span class="co"># share of the spRing season in the year</span>
      HOUR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        D <span class="op">=</span> <span class="fl">11</span> <span class="op">/</span> <span class="fl">24</span>, <span class="co"># share of day-hours in spRing</span>
        N <span class="op">=</span> <span class="fl">11</span> <span class="op">/</span> <span class="fl">24</span>, <span class="co"># share of night-hours in spRing</span>
        P <span class="op">=</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">24</span>
      <span class="op">)</span>
    <span class="op">)</span>, <span class="co"># share of peak hours in spRing</span>
    S <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span>, <span class="co"># share of the Summer season in the year</span>
      HOUR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        D <span class="op">=</span> <span class="fl">12</span> <span class="op">/</span> <span class="fl">24</span>, <span class="co"># share of day-hours in Summer</span>
        N <span class="op">=</span> <span class="fl">9</span> <span class="op">/</span> <span class="fl">24</span>, <span class="co"># share of night-hours in Summer</span>
        P <span class="op">=</span> <span class="fl">3</span> <span class="op">/</span> <span class="fl">24</span>
      <span class="op">)</span>
    <span class="op">)</span>, <span class="co"># share of peak hours in Summer)</span>
    A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span>, <span class="co"># share of the Autumn season in the year</span>
      HOUR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        D <span class="op">=</span> <span class="fl">11</span> <span class="op">/</span> <span class="fl">24</span>, <span class="co"># share of day-hours in Autumn</span>
        N <span class="op">=</span> <span class="fl">11</span> <span class="op">/</span> <span class="fl">24</span>, <span class="co"># share of night-hours in Autumn</span>
        P <span class="op">=</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">24</span>
      <span class="op">)</span>
    <span class="op">)</span> <span class="co"># share of peak hours in Autumn)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Four seasons and the three groups of hours will result in 12 sub-annual time-slices. If the spring and fall have similar parameters and can be aggregated into one season, reducing the total number of slices to 9. Though there might be reasons to separate them if, for example, the final demand is significantly different in the seasons, or some resources (like hydro-power) have a different profile in autumn and spring.</p>
</div>
<div id="months-and-representative-day-hours" class="section level2">
<h2 class="hasAnchor">
<a href="#months-and-representative-day-hours" class="anchor"></a>Months and representative day hours</h2>
<p>It is probably more natural to operate with real months and real hours, and easier from a data perspective. The following example has 12 months and 24 hours for each month, considering one representative day per month. Therefore this will result in 288 time slices per every year of the model. However, higher granularity comes with a computational penalty. Though for our toy model with only a few technologies, this is not a level of concern yet. If we disregard the differences in the length of the months, then the definition of time slices will be even easier - we won’t have to specify any shares, they will be assumed as equal during the model compilation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 24*1*12 = 288 time slices, two sub-annual levels</span>
<span class="va">timeslices3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  ANNUAL <span class="op">=</span> <span class="st">"ANNUAL"</span>, <span class="co"># this name is fixed, should not be changes</span>
  MONTH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="fu"><a href="https://rdrr.io/r/base/formatc.html">formatC</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, width <span class="op">=</span> <span class="fl">2</span>, flag <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span><span class="op">)</span>,
  HOUR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"h"</span>, <span class="fu"><a href="https://rdrr.io/r/base/formatc.html">formatC</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">23</span>, width <span class="op">=</span> <span class="fl">2</span>, flag <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>We have defined 3 different options of sub-annual time steps. The first option has only one level (“ANNUAL”), and two others also have months (or seasons) and groups of typical hours. The following definition of the model objects will rely on the chosen time structure. For example, some commodities or technologies can have higher granularity and will appear in the hour-level equations. Whereas others may have annual or season/month-level time resolution, that means they will appear only in their level balance equations. The names of slice levels and slices should be consistent across the model objects. Therefore the time-structure is fixed, model-specific. To make it a bit more flexible for playing with alternative specifications, we can have several time-structure with the same names of levels, like in lists <code>timeslices2</code> and <code>timeslices3</code> above. They both have “ANNUAL”, “MONTH”, and “HOUR” levels. Though the names of the slice-elements will be different, and we will have to avoid using them in the model specification.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Now let's create names for the slices, the elements of the time-slices set</span>
<span class="co"># They will be auto-generated in the model, but we may need them in definition of</span>
<span class="co"># technologies and other objects.</span>

<span class="co"># timeslices1 &lt;- list(</span>
<span class="co">#   ANNUAL = "ANNUAL", MONTH = list(1, HOUR = list(H = 1))</span>
<span class="co"># )</span>

<span class="co"># timeSlices(timeslices1) # Experimental -- not working yet</span>
<span class="fu">timeSlices</span><span class="op">(</span><span class="va">timeslices2</span><span class="op">)</span>
<span class="fu">timeSlices</span><span class="op">(</span><span class="va">timeslices3</span><span class="op">)</span>

<span class="co"># Choose time slices level</span>
<span class="va">timeslices</span> <span class="op">&lt;-</span> <span class="va">timeslices2</span>
<span class="co"># timeslices &lt;- timeslices3</span>

<span class="va">slc</span> <span class="op">&lt;-</span> <span class="fu">timeSlices</span><span class="op">(</span><span class="va">timeslices</span><span class="op">)</span>
<span class="op">(</span><span class="va">nslc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">slc</span><span class="op">$</span><span class="va">slice</span><span class="op">)</span><span class="op">)</span>
<span class="op">(</span><span class="va">nmon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">timeslices</span><span class="op">$</span><span class="va">MONTH</span><span class="op">)</span><span class="op">)</span>
<span class="op">(</span><span class="va">nhou</span> <span class="op">&lt;-</span> <span class="va">nslc</span> <span class="op">/</span> <span class="va">nmon</span><span class="op">)</span></code></pre></div>
<p>We will assign the time slices to the model-object later, but may also need the structure and/or names of the slices in the definition of other objects, such as technologies, demand, and supply, therefore useful to have them ready.</p>
</div>
</div>
<div id="electric-power-sector" class="section level1">
<h1 class="hasAnchor">
<a href="#electric-power-sector" class="anchor"></a>Electric power sector</h1>
<p>Electric generation is likely the most often modeled sector of RES. It has a number of alternative technological options which can be evaluated and compared with RES-models. The minimum set for the model is a declaration of commodities, technologies, supply, demand, and basic system parameters, like time-slices, as discussed above.</p>
<div id="commodities" class="section level2">
<h2 class="hasAnchor">
<a href="#commodities" class="anchor"></a>Commodities</h2>
<p>A “commodity” notion in the model is a generalization of goods, services, or emissions. Commodities link processes such as supply, technologies, demands as input or output. The minimum requirements to declare commodity is its name. Additional parameters can be stored in the class <code>commodity</code> for information and processing, most of the slots are currently reserved to be used in user-defined functions. The preferred way to create the class and fill it with data is the <code><a href="../reference/newCommodity.html">newCommodity()</a></code> function as shown below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">COA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"COA"</span>, <span class="co"># the name as it appears in the solver-software and the model sets</span>
  description <span class="op">=</span> <span class="st">"Generic coal"</span>, <span class="co"># just a comment</span>
  emis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="co"># emissions, associated with fuels combustion (see the flags in technologies)</span>
    comm <span class="op">=</span> <span class="st">"CO2"</span>, <span class="co"># this commodity (CO2) is emmited when the fuel (COA) is used</span>
    unit <span class="op">=</span> <span class="st">"kt/PJ"</span>, <span class="co"># the unit of emissions for refference</span>
    emis <span class="op">=</span> <span class="fl">100</span> <span class="co"># i.e. 100 kt of CO2 emmitted per one unit of energy (1 PJ)</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"ANNUAL"</span> <span class="co"># 'ANNUAL' means no sub-annual granularity for the commodity</span>
  <span class="co"># color = "brown" # reserved for output figures, optional</span>
<span class="op">)</span>

<span class="va">OIL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"OIL"</span>,
  description <span class="op">=</span> <span class="st">"Oil and oil products"</span>,
  emis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"CO2"</span>,
    emis <span class="op">=</span> <span class="fl">80</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"ANNUAL"</span>
<span class="op">)</span>

<span class="va">GAS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"GAS"</span>,
  description <span class="op">=</span> <span class="st">"Natural gas"</span>,
  emis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"CO2"</span>,
    unit <span class="op">=</span> <span class="st">"kt/PJ"</span>,
    emis <span class="op">=</span> <span class="fl">70</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"MONTH"</span> <span class="co"># This commodity will appear in month-level equations</span>
<span class="op">)</span>

<span class="va">CH4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"CH4"</span>,
  description <span class="op">=</span> <span class="st">"Methan emmisions"</span>,
  slice <span class="op">=</span> <span class="st">"HOUR"</span>
<span class="op">)</span>

<span class="va">BIO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"BIO"</span>,
  description <span class="op">=</span> <span class="st">"Generic biomass, all types"</span>,
  slice <span class="op">=</span> <span class="st">"ANNUAL"</span>
<span class="op">)</span>

<span class="co"># More energy commodities with less details</span>
<span class="va">ELC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"ELC"</span>, description <span class="op">=</span> <span class="st">"Electricity"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>
<span class="va">HVE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"HVE"</span>, description <span class="op">=</span> <span class="st">"High voltage electricity"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>
<span class="va">UHV</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"UHV"</span>, description <span class="op">=</span> <span class="st">"Ultra high voltage electricity"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>
<span class="va">NUC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"NUC"</span>, description <span class="op">=</span> <span class="st">"Nuclear fuel"</span>, slice <span class="op">=</span> <span class="st">"ANNUAL"</span><span class="op">)</span>
<span class="va">HYD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"HYD"</span>, description <span class="op">=</span> <span class="st">"Hydro energy"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>
<span class="va">SOL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"SOL"</span>, description <span class="op">=</span> <span class="st">"Solar energy"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>
<span class="va">WIN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"WIN"</span>, description <span class="op">=</span> <span class="st">"Wind energy"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>

<span class="co"># Emissions</span>
<span class="va">CO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"CO2"</span>, description <span class="op">=</span> <span class="st">"Carbon dioxide emissions"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>
<span class="va">NOX</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"NOX"</span>, description <span class="op">=</span> <span class="st">"Nitrogen oxide emissions"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>
<span class="va">SO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"SO2"</span>, description <span class="op">=</span> <span class="st">"Sulfur dioxide emissions"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>
<span class="va">HG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"HG"</span>, description <span class="op">=</span> <span class="st">"Mercury emissions"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span>
<span class="va">PM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"PM"</span>, description <span class="op">=</span> <span class="st">"Particulate matter emissions"</span>, slice <span class="op">=</span> <span class="st">"HOUR"</span><span class="op">)</span></code></pre></div>
</div>
<div id="the-final-demand" class="section level2">
<h2 class="hasAnchor">
<a href="#the-final-demand" class="anchor"></a>The final demand</h2>
<p>The final product in this model will be electricity (ELC), the final demand for ELC is exogenous. Since we defined <em>ELC</em> as an hour-level commodity, we specify demand for every time slice (the load curve) and every region where it is consumed. The number of hours (or groups of hours) is equal to the time-slices. In the case of the<br>
### Demand by months and hours hours Now let’s specify annual, monthly, and hourly demand for electricity, assuming that every region has a different level of ELC consumptions and the loadcurve. Instead of googling and web-scrapping the Utopia’s load curve, we generate it randomly for our example.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Annual demand in 2015</span>
<span class="va">elc_dem_a</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>
  region <span class="op">=</span> <span class="va">reg_names</span>,
  year <span class="op">=</span> <span class="fl">2015</span>,
  GWh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">5000</span>, by <span class="op">=</span> <span class="fl">500</span>, length.out <span class="op">=</span> <span class="va">nreg</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">elc_dem_a</span>

<span class="va">fLoadCurve</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">24</span>, <span class="va">seed</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">delt</span> <span class="op">=</span> <span class="fl">24</span> <span class="op">/</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">20</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># a function to generate an arbitrary load curve</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span>
  <span class="va">iter</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
  <span class="va">lc</span> <span class="op">&lt;-</span> <span class="fl">1.</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># ARMA</span>
    <span class="va">lc</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="va">lc</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="op">-</span><span class="fl">.1</span> <span class="op">*</span> <span class="op">(</span><span class="va">lc</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="va">delt</span>, <span class="va">delt</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">lc</span><span class="op">)</span> <span class="op">*</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">lc</span> <span class="op">+</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Hourly demand for every region</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>
  region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">reg_names</span>, each <span class="op">=</span> <span class="va">nslc</span><span class="op">)</span>,
  year <span class="op">=</span> <span class="fl">2015</span>,
  slice <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">slc</span><span class="op">$</span><span class="va">slice</span>, <span class="va">nreg</span><span class="op">)</span>,
  GWh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">elc_dem_a</span><span class="op">$</span><span class="va">GWh</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fu">fLoadCurve</span><span class="op">(</span><span class="va">nmon</span><span class="op">)</span><span class="op">)</span> <span class="op">%x%</span> <span class="fu">fLoadCurve</span><span class="op">(</span><span class="va">nhou</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">nslc</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">dem</span><span class="op">$</span><span class="va">GWh</span><span class="op">)</span>

<span class="co"># Check by aggregating back to annual numbers</span>
<span class="va">dem</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>GWh_agg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">GWh</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>GWh_a <span class="op">=</span> <span class="va">elc_dem_a</span><span class="op">$</span><span class="va">GWh</span><span class="op">)</span>

<span class="co"># Add month and hour for plots</span>
<span class="co"># dem$month &lt;- month.abb[as.numeric(substr(dem$slice, 2, 3))]</span>
<span class="co"># dem$hour &lt;- as.integer(substr(dem$slice, 6, 7))</span>
<span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">dem</span>, <span class="fu">select</span><span class="op">(</span><span class="va">slc</span>, <span class="va">MONTH</span>, <span class="va">HOUR</span>, <span class="va">slice</span>, <span class="va">share</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"slice"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>month <span class="op">=</span> <span class="va">MONTH</span><span class="op">)</span>
<span class="va">dem</span><span class="op">$</span><span class="va">hour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dem</span><span class="op">$</span><span class="va">HOUR</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">dem</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">hour</span>, <span class="va">GWh</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">month</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"(Assumed) Electricity consumption by hours in the base year"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="utopia_files/figure-html/demand_MH_baseYear-1.png"><!-- --></p>
<p>The demand for 2015 is done, now we need to provide projections of the demand up to the last year of the model horizon, and with the same level of granularity (regions * slices) as the base year, and the commodity (ELC) itself. We can specify the demand for every (milestone) year of the model horizon, or some of them. The values between specified years will be interpolated If the model horizon goes beyond the last year, the final values will be used for interpolation forward.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Adding annual demand for 2030 and 2055</span>
<span class="va">elc_dem_2030</span> <span class="op">&lt;-</span> <span class="va">dem</span>
<span class="va">elc_dem_2030</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fl">2030</span>
<span class="va">elc_dem_2030</span><span class="op">$</span><span class="va">GWh</span> <span class="op">&lt;-</span> <span class="va">dem</span><span class="op">$</span><span class="va">GWh</span> <span class="op">*</span> <span class="fl">2</span> <span class="co"># assuming two-fold growth by 2030</span>

<span class="va">elc_dem_2055</span> <span class="op">&lt;-</span> <span class="va">dem</span>
<span class="va">elc_dem_2055</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fl">2055</span> <span class="co"># The model horizon</span>
<span class="va">elc_dem_2055</span><span class="op">$</span><span class="va">GWh</span> <span class="op">&lt;-</span> <span class="va">dem</span><span class="op">$</span><span class="va">GWh</span> <span class="op">*</span> <span class="fl">3</span> <span class="co"># and 3-times by 2055</span>

<span class="va">elc_dem</span> <span class="op">&lt;-</span> <span class="va">dem</span> <span class="op">%&gt;%</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">elc_dem_2030</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">elc_dem_2055</span><span class="op">)</span>

<span class="co"># The model units in PJ, converting...</span>
<span class="va">elc_dem</span><span class="op">$</span><span class="va">PJ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"GWh"</span>, <span class="st">"PJ"</span>, <span class="va">elc_dem</span><span class="op">$</span><span class="va">GWh</span><span class="op">)</span>
<span class="va">elc_dem</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">elc_dem</span><span class="op">$</span><span class="va">region</span><span class="op">)</span>

<span class="va">DEM_ELC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newDemand.html">newDemand</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"DEM_ELC"</span>,
  description <span class="op">=</span> <span class="st">"Final demand for electricity"</span>,
  commodity <span class="op">=</span> <span class="st">"ELC"</span>,
  dem <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    year <span class="op">=</span> <span class="va">elc_dem</span><span class="op">$</span><span class="va">year</span>,
    region <span class="op">=</span> <span class="va">elc_dem</span><span class="op">$</span><span class="va">region</span>,
    slice <span class="op">=</span> <span class="va">elc_dem</span><span class="op">$</span><span class="va">slice</span>,
    dem <span class="op">=</span> <span class="va">elc_dem</span><span class="op">$</span><span class="va">PJ</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">DEM_ELC</span><span class="op">@</span><span class="va">dem</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">DEM_ELC</span><span class="op">@</span><span class="va">dem</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">DEM_ELC</span><span class="op">@</span><span class="va">dem</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">DEM_ELC</span><span class="op">@</span><span class="va">dem</span><span class="op">$</span><span class="va">slice</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="primary-supply" class="section level2">
<h2 class="hasAnchor">
<a href="#primary-supply" class="anchor"></a>Primary supply</h2>
<p>Primary commodities, such as primary energy sources, materials, appear in the RES-model either by export from the rest of the world, or supply. Neither, supply or export from ROW has capacity per se. The main difference between them is the origin of the commodity if it is domestic or foreign Here we assume that different regions of Utopia have different resources to stimulate trade between them. Function <code>newSupply</code> creates <code>supply</code> object with declared parameters. The annual, regional, or slice-level limits, as well as costs, can be assigned with <code>availability</code> parameters.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If we assume that coal is abundunt resource, available in every region with the same price,</span>
<span class="co"># we don't have to declare @region of the supply.</span>
<span class="va">SUP_COA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newSupply.html">newSupply</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"SUP_COA"</span>,
  description <span class="op">=</span> <span class="st">"Supply of coal"</span>,
  commodity <span class="op">=</span> <span class="st">"COA"</span>,
  unit <span class="op">=</span> <span class="st">"PJ"</span>,
  reserve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>res.up <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span>, <span class="co"># total limit of the resource (i.e. deposits)</span>
  region <span class="op">=</span> <span class="va">reg_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
  availability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2030</span>, <span class="fl">2050</span><span class="op">)</span>,
    ava.up <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">1000</span><span class="op">)</span>, <span class="co"># the upper bound on availability of the commodity</span>
    cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"USD/tce"</span>, <span class="st">"MUSD/PJ"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">70</span><span class="op">)</span> <span class="op">*</span> <span class="fl">.7</span><span class="op">)</span><span class="op">)</span> <span class="co"># assumed price per 1PJ</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"ANNUAL"</span>
<span class="op">)</span></code></pre></div>
<p>The saved parameter can be checked in <code>SUP_COA@availability</code> slot:</p>
<table class="table">
<thead><tr class="header">
<th align="left">region</th>
<th align="right">year</th>
<th align="left">slice</th>
<th align="right">ava.lo</th>
<th align="right">ava.up</th>
<th align="right">ava.fx</th>
<th align="right">cost</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="right">2015</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">1000</td>
<td align="right">NA</td>
<td align="right">1.194213</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">2030</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">2000</td>
<td align="right">NA</td>
<td align="right">1.433056</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">2050</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">1000</td>
<td align="right">NA</td>
<td align="right">1.671898</td>
</tr>
</tbody>
</table>
<p>The <code>NA</code> values mean “for all” by default in columns with sets (<code>region</code>, <code>year</code>, <code>slice</code>) or “no constraint” in columns with numeric parameters. The values between the specified years will be linearly interpolated by default.<br>
Similarly, for other primary commodities:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>
<span class="va">SUP_GAS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newSupply.html">newSupply</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"SUP_GAS"</span>,
  description <span class="op">=</span> <span class="st">"Supply of natural gas"</span>,
  commodity <span class="op">=</span> <span class="st">"GAS"</span>,
  unit <span class="op">=</span> <span class="st">"PJ"</span>,
  reserve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>res.up <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1e3</span>, <span class="fl">1e6</span><span class="op">)</span><span class="op">)</span>, <span class="co">#</span>
  region <span class="op">=</span> <span class="va">reg_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">]</span>, <span class="co"># only those regions will have the supply</span>
  availability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2030</span>, <span class="fl">2050</span><span class="op">)</span>,
    ava.up <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">1000</span><span class="op">)</span>,
    cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"USD/tce"</span>, <span class="st">"MUSD/PJ"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">70</span>, <span class="fl">80</span><span class="op">)</span> <span class="op">*</span> <span class="fl">.7</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"ANNUAL"</span>
<span class="op">)</span>

<span class="va">SUP_NUC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newSupply.html">newSupply</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"SUP_NUC"</span>,
  commodity <span class="op">=</span> <span class="st">"NUC"</span>,
  availability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    cost <span class="op">=</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"USD/MWh"</span>, <span class="st">"MUSD/PJ"</span>, <span class="fl">4</span><span class="op">)</span> <span class="co"># assumed</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"ANNUAL"</span>
<span class="op">)</span>

<span class="va">RES_HYD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newSupply.html">newSupply</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"RES_HYD"</span>,
  commodity <span class="op">=</span> <span class="st">"HYD"</span>,
  availability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    ava.up <span class="op">=</span> <span class="fl">1e3</span>,
    cost <span class="op">=</span> <span class="fl">0</span> <span class="co"># no price to the resource, can be dropped</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">RES_SOL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newSupply.html">newSupply</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"RES_SOL"</span>,
  commodity <span class="op">=</span> <span class="st">"SOL"</span>
  <span class="co"># availability will be defined by weather factors (see below)</span>
<span class="op">)</span>

<span class="va">RES_WIN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newSupply.html">newSupply</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"RES_WIN"</span>,
  commodity <span class="op">=</span> <span class="st">"WIN"</span>
  <span class="co"># availability will be defined by weather factors (see below)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="technologies" class="section level2">
<h2 class="hasAnchor">
<a href="#technologies" class="anchor"></a>Technologies</h2>
<p>Technologies (techs) are the key part of the RES-modeling. This topic is broad and deserves a separate tutorial (in progress). By now, the main ideas to keep in mind:<br>
– techs take some commodities as input and generate other as output;<br>
– there are several levels of transformation of input into output, with two main intermediate steps: <code>use</code> and <code>activity</code>;<br>
– <code>use</code> can be seen as an aggregation of all inputs with various weights into one level, then all the comm…</p>
<div id="coal-power-plant" class="section level3">
<h3 class="hasAnchor">
<a href="#coal-power-plant" class="anchor"></a>Coal power plant</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Coal-fired power plants ####</span>
<span class="va">ECOA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newTechnology.html">newTechnology</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"ECOA"</span>,
  description <span class="op">=</span> <span class="st">"Generic Coal Power Plant"</span>,
  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"COA"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>,
    combustion <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span>,
  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"ELC"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  aux <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    acomm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HG"</span>, <span class="st">"NOX"</span>, <span class="st">"PM"</span>, <span class="st">"SO2"</span><span class="op">)</span>,
    unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="st">"kt"</span>, <span class="st">"kt"</span>, <span class="st">"kt"</span><span class="op">)</span>
  <span class="op">)</span>,
  cap2act <span class="op">=</span> <span class="fl">31.536</span>,
  ceff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># region = "R1",</span>
    <span class="co"># year = c(2015),</span>
    comm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COA"</span><span class="op">)</span>,
    cinp2use <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.4</span><span class="op">)</span>
  <span class="op">)</span>,
  aeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    acomm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HG"</span>, <span class="st">"NOX"</span>, <span class="st">"SO2"</span>, <span class="st">"PM"</span><span class="op">)</span>,
    act2aout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">.2</span><span class="op">)</span>
  <span class="op">)</span>,
  afs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    slice <span class="op">=</span> <span class="st">"ANNUAL"</span>,
    afs.up <span class="op">=</span> <span class="fl">.6</span>
  <span class="op">)</span>,
  fixom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    fixom <span class="op">=</span> <span class="fl">100</span>
  <span class="op">)</span>,
  invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    invcost <span class="op">=</span> <span class="fl">1500</span>
  <span class="op">)</span>,
  stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">reg_names</span>, <span class="va">reg_names</span><span class="op">)</span>,
    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="va">nreg</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2045</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">)</span>,
    stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">nreg</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fl">2010</span>
  <span class="op">)</span>,
  olife <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    olife <span class="op">=</span> <span class="fl">30</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"HOUR"</span>
<span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ECOA</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="utopia_files/figure-html/techs_ECOA-1.png" alt=""><p class="caption">Coal-fired power plant.</p>
</div>
</div>
<div id="gas-power-plant" class="section level3">
<h3 class="hasAnchor">
<a href="#gas-power-plant" class="anchor"></a>Gas power plant</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Gas-fired power plant ####</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1e3</span><span class="op">)</span>
<span class="va">EGAS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newTechnology.html">newTechnology</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"EGAS"</span>,
  description <span class="op">=</span> <span class="st">"Generic gas Power Plant"</span>,
  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"GAS"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>,
    combustion <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span>,
  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"ELC"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  aux <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    acomm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NOX"</span>, <span class="st">"CH4"</span><span class="op">)</span>,
    unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"kt"</span>, <span class="st">"kt"</span><span class="op">)</span>
  <span class="op">)</span>,
  cap2act <span class="op">=</span> <span class="fl">31.536</span>,
  ceff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># region = "R1",</span>
    <span class="co"># year = c(2015),</span>
    comm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GAS"</span><span class="op">)</span>,
    cinp2use <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span>
  <span class="op">)</span>,
  aeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    acomm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NOX"</span>, <span class="st">"CH4"</span><span class="op">)</span>,
    act2aout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">.1</span><span class="op">)</span> <span class="co"># arbitrary</span>
  <span class="op">)</span>,
  afs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    slice <span class="op">=</span> <span class="st">"ANNUAL"</span>,
    afs.up <span class="op">=</span> <span class="fl">.8</span>
  <span class="op">)</span>,
  fixom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    fixom <span class="op">=</span> <span class="fl">100</span>
  <span class="op">)</span>,
  invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    invcost <span class="op">=</span> <span class="fl">1200</span>
  <span class="op">)</span>,
  stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">reg_names</span>, <span class="va">reg_names</span><span class="op">)</span>,
    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="va">nreg</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2040</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">)</span>,
    stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">nreg</span>, <span class="fl">.2</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">)</span> <span class="co"># phasing out</span>
  <span class="op">)</span>,
  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fl">2010</span>
  <span class="op">)</span>,
  olife <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    olife <span class="op">=</span> <span class="fl">30</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"HOUR"</span>
<span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">EGAS</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="utopia_files/figure-html/techs_EGAS-1.png" alt=""><p class="caption">Gas-fired power plant.</p>
</div>
</div>
<div id="biomass-to-power-plant" class="section level3">
<h3 class="hasAnchor">
<a href="#biomass-to-power-plant" class="anchor"></a>Biomass-to-power plant</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Biomass-cofired power plants ####</span>
<span class="va">EBIO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newTechnology.html">newTechnology</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"EBIO"</span>,
  description <span class="op">=</span> <span class="st">"Generic Biomass-fired power plant"</span>,
  region <span class="op">=</span> <span class="va">reg_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">7</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">]</span>,
  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"BIO"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>,
    combustion <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span>,
  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"ELC"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  aux <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    acomm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NOX"</span>, <span class="st">"PM"</span>, <span class="st">"CH4"</span><span class="op">)</span>,
    unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"kt"</span>, <span class="st">"kt"</span>, <span class="st">"kt"</span><span class="op">)</span>
  <span class="op">)</span>,
  cap2act <span class="op">=</span> <span class="fl">31.536</span>,
  ceff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BIO"</span><span class="op">)</span>,
    cinp2use <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">)</span>
  <span class="op">)</span>,
  aeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    acomm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NOX"</span>, <span class="st">"PM"</span>, <span class="st">"CH4"</span><span class="op">)</span>,
    act2aout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">.01</span><span class="op">)</span>
  <span class="op">)</span>,
  afs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># activity level bounds per sum of listed slices ('ANNUAL')</span>
    slice <span class="op">=</span> <span class="st">"ANNUAL"</span>,
    afs.up <span class="op">=</span> <span class="fl">.5</span>
  <span class="op">)</span>,
  fixom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    fixom <span class="op">=</span> <span class="fl">50</span>
  <span class="op">)</span>,
  varom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    varom <span class="op">=</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"USD/MWh"</span>, <span class="st">"MUSD/PJ"</span>, <span class="fl">.5</span><span class="op">)</span> <span class="co"># Assumption</span>
  <span class="op">)</span>,
  invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># year = 2015,</span>
    invcost <span class="op">=</span> <span class="fl">2000</span>
  <span class="op">)</span>,
  <span class="co"># # stock = data.frame(</span>
  <span class="co">#   region = ,</span>
  <span class="co">#   year = ,</span>
  <span class="co">#   stock = )</span>
  <span class="co"># ),</span>
  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fl">2010</span>
  <span class="op">)</span>,
  olife <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    olife <span class="op">=</span> <span class="fl">30</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"HOUR"</span>
<span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">EBIO</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="utopia_files/figure-html/techs_EBIO-1.png" alt=""><p class="caption">Biomass-to-power technology.</p>
</div>
</div>
<div id="nuclear-power" class="section level3">
<h3 class="hasAnchor">
<a href="#nuclear-power" class="anchor"></a>Nuclear power</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Nuclear power plant #</span>
<span class="va">ENUC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newTechnology.html">newTechnology</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"ENUC"</span>,
  description <span class="op">=</span> <span class="st">"Nuclear power plants"</span>,
  region <span class="op">=</span> <span class="va">reg_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"NUC"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"ELC"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  cap2act <span class="op">=</span> <span class="fl">31.536</span>,
  ceff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NUC"</span><span class="op">)</span>,
    cinp2use <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.35</span><span class="op">)</span>
  <span class="op">)</span>,
  af <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    af.lo <span class="op">=</span> <span class="fl">.8</span>
  <span class="op">)</span>,
  fixom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    fixom <span class="op">=</span> <span class="fl">30</span>
  <span class="op">)</span>,
  invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    invcost <span class="op">=</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"USD/kW"</span>, <span class="st">"MUSD/GW"</span>, <span class="fl">3500</span><span class="op">)</span>
  <span class="op">)</span>,
  stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    region <span class="op">=</span> <span class="va">reg_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2060</span><span class="op">)</span>,
    stock <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span>,
  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fl">2010</span>
  <span class="op">)</span>,
  end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    end <span class="op">=</span> <span class="fl">2030</span>
  <span class="op">)</span>,
  olife <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    olife <span class="op">=</span> <span class="fl">60</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"HOUR"</span>
<span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ENUC</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="utopia_files/figure-html/techs_Nuclear-1.png" alt=""><p class="caption">Nuclear power technology.</p>
</div>
</div>
<div id="hydro-power" class="section level3">
<h3 class="hasAnchor">
<a href="#hydro-power" class="anchor"></a>Hydro power</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EHYD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newTechnology.html">newTechnology</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"EHYD"</span>,
  description <span class="op">=</span> <span class="st">"Hydro power plants"</span>,
  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"HYD"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>,
    combustion <span class="op">=</span> <span class="fl">0</span>
  <span class="op">)</span>,
  region <span class="op">=</span> <span class="va">reg_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">]</span>,
  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"ELC"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  cap2act <span class="op">=</span> <span class="fl">31.536</span>,
  ceff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HYD"</span><span class="op">)</span>,
    cinp2use <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
  <span class="op">)</span>,
  af <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    af.lo <span class="op">=</span> <span class="fl">0.15</span>
  <span class="op">)</span>,
  afs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    slice <span class="op">=</span> <span class="st">"ANNUAL"</span>,
    afs.up <span class="op">=</span> <span class="fl">.4</span>,
    afs.lo <span class="op">=</span> <span class="fl">.3</span>
  <span class="op">)</span>,
  fixom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    fixom <span class="op">=</span> <span class="fl">61.4</span>
  <span class="op">)</span>,
  invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    invcost <span class="op">=</span> <span class="fl">5000</span>
  <span class="op">)</span>,
  stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    region <span class="op">=</span> <span class="va">reg_names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">]</span>,
    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2060</span><span class="op">)</span>,
    stock <span class="op">=</span> <span class="fl">5</span>
  <span class="op">)</span>,
  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fl">2060</span>
  <span class="op">)</span>,
  olife <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    olife <span class="op">=</span> <span class="fl">80</span>
  <span class="op">)</span>,
  slice <span class="op">=</span> <span class="st">"HOUR"</span>
<span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">EHYD</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="utopia_files/figure-html/techs_Hydro-1.png" alt=""><p class="caption">Hydro power technology.</p>
</div>
</div>
<div id="weather-factors" class="section level3">
<h3 class="hasAnchor">
<a href="#weather-factors" class="anchor"></a>Weather factors</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The weather information can be obtained from Utopia'a weather agency.</span>
<span class="co"># Here we just randomly generate solar and wind availability factors (AF).</span>
<span class="co"># For wind we can target, say, 25% annual AF, which can be achieved with</span>
<span class="co"># around 35% of the time when the wind is available, and the mean speed of wind</span>
<span class="co"># tending to 80% of maximum output capacity of wind plants.</span>
<span class="co"># For simplicity, let's disregard seasonal components, spatial</span>
<span class="co"># and temporal autocorrelation.</span>
<span class="co">#</span>

<span class="co"># Wind availability function</span>
<span class="va">rwind</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">sh1</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">sh2</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">pwind</span> <span class="op">=</span> <span class="fl">.35</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># pwind - probability of wind</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">sh1</span>, <span class="va">sh2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n</span>, <span class="cn">TRUE</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">pwind</span>, <span class="va">pwind</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Check</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu">rwind</span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span><span class="op">)</span>

<span class="co"># We can use similar approach for clouds, assuming that expected value for</span>
<span class="co"># sky transparency is 70%, applying it to solar radiation profile by hours.</span>
<span class="va">rclouds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">sh1</span> <span class="op">=</span> <span class="fl">3.5</span>, <span class="va">sh2</span> <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">sh1</span>, <span class="va">sh2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu">rclouds</span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu">rclouds</span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"lightblue"</span>, probability <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="utopia_files/figure-html/weather-1.png"><!-- --></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Solar radiation as function of time slice</span>
<span class="va">solrad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">slice</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">slice</span><span class="op">)</span><span class="op">)</span> <span class="va">slice</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">slice</span><span class="op">)</span>
  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">slice</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># assuming no difference between months/seasons for sunlight</span>
  <span class="va">if_h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"_h"</span>, <span class="va">slice</span><span class="op">)</span>
  <span class="va">if_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"_D$"</span>, <span class="va">slice</span><span class="op">)</span>
  <span class="co"># browser()</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">if_h</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># propose function of solar radiation by hours</span>
    <span class="va">fsun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">h</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">rad</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="va">h</span><span class="op">)</span> <span class="op">/</span> <span class="fl">23</span><span class="op">)</span>
      <span class="va">rad</span><span class="op">[</span><span class="va">rad</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
      <span class="va">rad</span>
    <span class="op">}</span>
    <span class="co"># extract hours as numbers from slices of type "m**_h**"</span>
    <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">slice</span><span class="op">[</span><span class="va">if_h</span><span class="op">]</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>
    <span class="va">idx</span><span class="op">[</span><span class="va">if_h</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">fsun</span><span class="op">(</span><span class="va">h</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">if_D</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">idx</span><span class="op">[</span><span class="va">if_D</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
    <span class="co"># assign some sun for Peak hours</span>
    <span class="va">if_P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"_P$"</span>, <span class="va">slice</span><span class="op">)</span>
    <span class="va">idx</span><span class="op">[</span><span class="va">if_P</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">.5</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"unknown slices: "</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">slice</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">idx</span>
<span class="op">}</span>

<span class="kw">if</span> <span class="op">(</span><span class="cn">F</span><span class="op">)</span> <span class="op">{</span> <span class="co"># test</span>
  <span class="va">rad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">slc</span><span class="op">$</span><span class="va">slice</span>, <span class="fu">solrad</span><span class="op">(</span><span class="va">slc</span><span class="op">$</span><span class="va">slice</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rad</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1111</span><span class="op">)</span>
<span class="va">WWIN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newWeather.html">newWeather</a></span><span class="op">(</span><span class="st">"WWIN"</span>,
  description <span class="op">=</span> <span class="st">"Wind availability factor"</span>,
  slice <span class="op">=</span> <span class="st">"HOUR"</span>,
  weather <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">reg_names</span>, each <span class="op">=</span> <span class="va">nslc</span><span class="op">)</span>,
    year <span class="op">=</span> <span class="fl">2015</span>,
    slice <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">slc</span><span class="op">$</span><span class="va">slice</span>, <span class="va">nreg</span><span class="op">)</span>,
    wval <span class="op">=</span> <span class="fu">rwind</span><span class="op">(</span><span class="va">nreg</span> <span class="op">*</span> <span class="va">nslc</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">WSOL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newWeather.html">newWeather</a></span><span class="op">(</span><span class="st">"WSOL"</span>,
  description <span class="op">=</span> <span class="st">"Solar radiation index"</span>,
  slice <span class="op">=</span> <span class="st">"HOUR"</span>,
  weather <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">reg_names</span>, each <span class="op">=</span> <span class="va">nslc</span><span class="op">)</span>,
    year <span class="op">=</span> <span class="fl">2015</span>,
    slice <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">slc</span><span class="op">$</span><span class="va">slice</span>, <span class="va">nreg</span><span class="op">)</span>,
    wval <span class="op">=</span> <span class="fl">0</span> <span class="co"># assign later</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">WSOL</span><span class="op">@</span><span class="va">weather</span><span class="op">$</span><span class="va">wval</span> <span class="op">&lt;-</span> <span class="fu">rclouds</span><span class="op">(</span><span class="va">nreg</span> <span class="op">*</span> <span class="va">nslc</span><span class="op">)</span> <span class="op">*</span> <span class="fu">solrad</span><span class="op">(</span><span class="va">WSOL</span><span class="op">@</span><span class="va">weather</span><span class="op">$</span><span class="va">slice</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">WSOL</span><span class="op">@</span><span class="va">weather</span><span class="op">$</span><span class="va">wval</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">WSOL</span><span class="op">@</span><span class="va">weather</span><span class="op">$</span><span class="va">wval</span><span class="op">)</span>

<span class="kw">if</span> <span class="op">(</span><span class="cn">F</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">WSOL</span><span class="op">@</span><span class="va">weather</span><span class="op">$</span><span class="va">wval</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="solar-arrays" class="section level3">
<h3 class="hasAnchor">
<a href="#solar-arrays" class="anchor"></a>Solar arrays</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ESOL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newTechnology.html">newTechnology</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"ESOL"</span>,
  description <span class="op">=</span> <span class="st">"Solar PV farm"</span>,
  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"SOL"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"ELC"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  cap2act <span class="op">=</span> <span class="fl">31.536</span>,
  weather <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    weather <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WSOL"</span><span class="op">)</span>,
    waf.up <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># * af.s * WSOL@weather$wval</span>
  <span class="op">)</span>,
  fixom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    fixom <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span>,
  invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    invcost <span class="op">=</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"USD/W"</span>, <span class="st">"MUSD/GW"</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="op">)</span>,
  stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">reg_names</span>, <span class="va">reg_names</span><span class="op">)</span>,
    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="va">nreg</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2035</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">)</span>,
    stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">nreg</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fl">2015</span>
  <span class="op">)</span>,
  olife <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    olife <span class="op">=</span> <span class="fl">25</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ESOL</span><span class="op">)</span></code></pre></div>
<p><img src="utopia_files/figure-html/solar_PV-1.png"><!-- --></p>
</div>
<div id="wind-farms" class="section level3">
<h3 class="hasAnchor">
<a href="#wind-farms" class="anchor"></a>Wind farms</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EWIN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newTechnology.html">newTechnology</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"EWIN"</span>,
  description <span class="op">=</span> <span class="st">"Wind power plants"</span>,
  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"WIN"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="st">"ELC"</span>,
    unit <span class="op">=</span> <span class="st">"PJ"</span>
  <span class="op">)</span>,
  cap2act <span class="op">=</span> <span class="fl">31.536</span>,
  ceff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    comm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WIN"</span><span class="op">)</span>,
    cinp2use <span class="op">=</span> <span class="fl">1</span>,
    afc.up <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span>,
  weather <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    weather <span class="op">=</span> <span class="st">"WWIN"</span>,
    comm <span class="op">=</span> <span class="st">"WIN"</span>,
    waf.up <span class="op">=</span> <span class="fl">1</span> <span class="co">#</span>
  <span class="op">)</span>,
  fixom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    fixom <span class="op">=</span> <span class="fl">3</span>
  <span class="op">)</span>,
  invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    invcost <span class="op">=</span> <span class="fl">1500</span>
  <span class="op">)</span>,
  stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">reg_names</span>, <span class="va">reg_names</span><span class="op">)</span>,
    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="va">nreg</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2035</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">)</span>,
    stock <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">nreg</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nreg</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fl">2015</span>
  <span class="op">)</span>,
  olife <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    olife <span class="op">=</span> <span class="fl">25</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">EWIN</span><span class="op">)</span></code></pre></div>
<p><img src="utopia_files/figure-html/wind_farm-1.png"><!-- --></p>
</div>
<div id="energy-storage-systems" class="section level3">
<h3 class="hasAnchor">
<a href="#energy-storage-systems" class="anchor"></a>Energy storage systems</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">STGELC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newStorage.html">newStorage</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"STGELC"</span>,
  commodity <span class="op">=</span> <span class="st">"ELC"</span>,
  description <span class="op">=</span> <span class="st">"Energy storage systems"</span>,
  cap2stg <span class="op">=</span> <span class="fl">1</span>,
  olife <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>olife <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
  invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    invcost <span class="op">=</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"USD/kWh"</span>, <span class="st">"MUSD/PJ"</span>, <span class="fl">200</span><span class="op">)</span>
  <span class="op">)</span>,
  seff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    stgeff <span class="op">=</span> <span class="fl">.99</span>,
    inpeff <span class="op">=</span> <span class="fl">.9</span>,
    outeff <span class="op">=</span> <span class="fl">.95</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
<div id="interregional-trade" class="section level2">
<h2 class="hasAnchor">
<a href="#interregional-trade" class="anchor"></a>Interregional trade</h2>
<p>The trade is basically a definition of trade routes between regions for each commodity and each direction. There are many ways to arrange the trade routes, which is growing with the number of regions. Here we define trade between neihbor regions, which opens flows between all uninsulated regions. The neighbor regions can be obtained based on the GIS info.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Neighbor regions</span>
<span class="va">nbr</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spdep/man/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">gis</span>, snap <span class="op">=</span> <span class="fl">.001</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">nbr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">gis</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">region</span>

<span class="co"># Trade matrix</span>
<span class="va">trd_nbr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">nreg</span> <span class="op">*</span> <span class="va">nreg</span><span class="op">)</span>,
  nrow <span class="op">=</span> <span class="va">nreg</span>,
  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">reg_names</span>, <span class="va">reg_names</span><span class="op">)</span>
<span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">reg_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">trd_nbr</span><span class="op">[</span><span class="va">i</span>, <span class="va">nbr</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="va">trd_nbr</span><span class="op">[</span><span class="va">nbr</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">trd_nbr</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">trd_nbr</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Trade routes matrix.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">R1</th>
<th align="right">R2</th>
<th align="right">R3</th>
<th align="right">R4</th>
<th align="right">R5</th>
<th align="right">R6</th>
<th align="right">R7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">R1</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">R2</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">R3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">R4</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">R5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">R6</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">R7</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>We can visualize the open trade routes over the map.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data frame of trade routes</span>
<span class="va">trd_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">as.data.frame.table</a></span><span class="op">(</span><span class="va">trd_nbr</span>, stringsAsFactors <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">trd_dt</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>, <span class="op">]</span> <span class="co"># drop NAs</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">)</span>
<span class="va">trd_dt</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">)</span> <span class="co"># drop duplicates</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"src"</span>, <span class="st">"dst"</span>, <span class="st">"trd"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">)</span>

<span class="co"># Map inter-region trade routes</span>
<span class="va">trd_rou</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">trd_dt</span>, <span class="va">reg_centers</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"src"</span> <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span><span class="op">)</span>
<span class="va">trd_rou</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">trd_rou</span>, <span class="va">reg_centers</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dst"</span> <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span><span class="op">)</span>
<span class="va">trd_rou</span> <span class="op">&lt;-</span> <span class="va">trd_rou</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>
    xsrc <span class="op">=</span> <span class="va">x.x</span>, ysrc <span class="op">=</span> <span class="va">y.x</span>,
    xdst <span class="op">=</span> <span class="va">x.y</span>, ydst <span class="op">=</span> <span class="va">y.y</span>
  <span class="op">)</span>
<span class="va">trd_rou</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">trd_rou</span><span class="op">)</span>

<span class="co"># a &lt;- value</span>
<span class="va">trd_flows_map</span> <span class="op">&lt;-</span>
  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ggis</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,
    fill <span class="op">=</span> <span class="st">"wheat"</span>,
    colour <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">.5</span>
  <span class="op">)</span> <span class="op">+</span> <span class="co"># aes fill = id,</span>
  <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="co"># do this to leave off the color legend</span>
  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Open interregional electricity trade routes"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">xsrc</span>, y <span class="op">=</span> <span class="va">ysrc</span>, xend <span class="op">=</span> <span class="va">xdst</span>, yend <span class="op">=</span> <span class="va">ydst</span><span class="op">)</span>,
    data <span class="op">=</span> <span class="va">trd_rou</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, size <span class="op">=</span> <span class="fl">5</span>,
    alpha <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"dodgerblue"</span>, lineend <span class="op">=</span> <span class="st">"round"</span>, show.legend <span class="op">=</span> <span class="cn">T</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">reg_centers</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">xsrc</span>, y <span class="op">=</span> <span class="va">ysrc</span>, xend <span class="op">=</span> <span class="va">xdst</span>, yend <span class="op">=</span> <span class="va">ydst</span><span class="op">)</span>,
    data <span class="op">=</span> <span class="va">trd_rou</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, size <span class="op">=</span> <span class="fl">.1</span>,
    arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>
      type <span class="op">=</span> <span class="st">"closed"</span>, angle <span class="op">=</span> <span class="fl">15</span>,
      length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"inches"</span><span class="op">)</span>
    <span class="op">)</span>,
    colour <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>,
    lineend <span class="op">=</span> <span class="st">"butt"</span>, linejoin <span class="op">=</span> <span class="st">"mitre"</span>, show.legend <span class="op">=</span> <span class="cn">T</span>
  <span class="op">)</span> <span class="co"># , name = "Trade, PJ"</span>
<span class="va">trd_flows_map</span></code></pre></div>
<div class="figure">
<img src="utopia_files/figure-html/trade_map-1.png" alt=""><p class="caption">Trade routes.</p>
</div>
<p>For every trade-route, direction, and every traded commodity we have to define an object of class <code>trade</code> to open the trades in the model. To simplify the process, we can group the trades by source regions. Therefore we will have up to 7 trade objects.</p>
<div id="trade" class="section level3">
<h3 class="hasAnchor">
<a href="#trade" class="anchor"></a>Trade</h3>
<p>For electric power sector model, we can potentially consider trades as dispatch, adding various levels of voltages, or we may want to add an option for primary commodities trade between regions. In this simplified demonstration we define trade for electricity itself, without consideration of different levels of voltages, as well as investments in grid. It can be done adding into the model more technologies, such as transformers, and the grid-lines. Though this type of models don’t have such details as grid simulation models have. …</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define trade losses</span>
<span class="va">trd_dt</span><span class="op">$</span><span class="va">distance_km</span> <span class="op">&lt;-</span> <span class="fl">0.</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">rg_dst</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">dst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">rg_src</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">src</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="co"># lab_dst &lt;- reg_centers[rg_dst, 2:3]</span>
  <span class="co"># lab_src &lt;- reg_centers[rg_src, 2:3]</span>
  <span class="va">lab_dst</span> <span class="op">&lt;-</span> <span class="va">reg_centers</span><span class="op">[</span><span class="va">reg_centers</span><span class="op">$</span><span class="va">region</span> <span class="op">==</span> <span class="va">rg_dst</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>
  <span class="va">lab_src</span> <span class="op">&lt;-</span> <span class="va">reg_centers</span><span class="op">[</span><span class="va">reg_centers</span><span class="op">$</span><span class="va">region</span> <span class="op">==</span> <span class="va">rg_src</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>
  <span class="va">trd_dt</span><span class="op">$</span><span class="va">distance_km</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/pointDistance.html">pointDistance</a></span><span class="op">(</span>
    <span class="va">lab_src</span>, <span class="va">lab_dst</span>, <span class="cn">T</span>
  <span class="op">)</span> <span class="op">/</span> <span class="fl">1e3</span>
<span class="op">}</span>

<span class="co"># Assume losses 1% per 1000 km</span>
<span class="va">trd_dt</span><span class="op">$</span><span class="va">losses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">$</span><span class="va">distance_km</span> <span class="op">/</span> <span class="fl">1e3</span> <span class="op">*</span> <span class="fl">0.01</span>, <span class="fl">4</span><span class="op">)</span>
<span class="va">trd_dt</span><span class="op">$</span><span class="va">teff</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">losses</span>
<span class="co"># Assuming 0.1 US cents per kWh per 1000 km for the transmission</span>
<span class="va">trd_dt</span><span class="op">$</span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">$</span><span class="va">distance_km</span> <span class="op">/</span> <span class="fl">1e3</span> <span class="op">*</span>
  <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"USD/kWh"</span>, <span class="st">"MUSD/GWh"</span>, <span class="fl">.001</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">trd_dt</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">trd_dt</span><span class="op">)</span>

<span class="co"># A repository for trades, related technologies and commodities</span>
<span class="va">TRD_ELC_ALL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newRepository.html">newRepository</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"TRD_ELC_ALL"</span><span class="op">)</span>
<span class="co"># Define trade object for each route</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">src_nm</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">$</span><span class="va">src</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># The loop creates trade-objects for every region with neighbors,</span>
  <span class="va">ii</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">src</span> <span class="op">%in%</span> <span class="va">src_nm</span> <span class="co"># select routes for the source region</span>
  <span class="va">dst_nms</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">dst</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="co"># all destinations from the region</span>
  <span class="va">trd_nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"TRD_ELC_"</span>, <span class="va">src_nm</span><span class="op">)</span> <span class="co"># Trade object name</span>
  <span class="va">cmd_nm</span> <span class="op">&lt;-</span> <span class="st">"ELC"</span>
  <span class="va">cmd_nm_nbr</span> <span class="op">&lt;-</span> <span class="st">"ELC"</span>

  <span class="co"># Trade class for every route</span>
  <span class="va">trd</span> <span class="op">&lt;-</span> <span class="fu">newTrade</span><span class="op">(</span><span class="va">trd_nm</span>,
    commodity <span class="op">=</span> <span class="va">cmd_nm</span>,
    source <span class="op">=</span> <span class="va">src_nm</span>,
    destination <span class="op">=</span> <span class="va">dst_nms</span>,
    trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      src <span class="op">=</span> <span class="va">src_nm</span>,
      dst <span class="op">=</span> <span class="va">dst_nms</span>,
      ava.up <span class="op">=</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"GWh"</span>, <span class="st">"PJ"</span>, <span class="fl">100</span><span class="op">)</span>, <span class="co"># Maximum capacity per route in GW</span>
      teff <span class="op">=</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">teff</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span>, <span class="co"># trade losses</span>
      cost <span class="op">=</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">cost</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="co"># trade costs</span>
      <span class="co"># markup = trd_dt$cost[ii] # and/or markup</span>
    <span class="op">)</span>,
    <span class="co"># !!! New stuff - testing</span>
    capacityVariable <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># endogenous trade capacity &amp; investments</span>
    <span class="co"># bidirectional = TRUE, # oppenes reverse direction of the trade</span>
    invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      region <span class="op">=</span> <span class="va">src_nm</span>,
      <span class="co"># dst = dst_nms,</span>
      invcost <span class="op">=</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">distance_km</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">/</span> <span class="fl">1e3</span> <span class="op">*</span> <span class="fl">250</span> <span class="co"># Assuming $250 MUSD/1000km</span>
    <span class="op">)</span>
  <span class="op">)</span>
  <span class="va">TRD_ELC_ALL</span> <span class="op">&lt;-</span> <span class="fu">add</span><span class="op">(</span><span class="va">TRD_ELC_ALL</span>, <span class="va">trd</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">### Bi-directional trade routes with endogenous capacity - !!!testing</span>
<span class="co"># first - find unique pairs of regions</span>
<span class="va">trd_dt2</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span>
<span class="va">trd_dt2</span><span class="op">$</span><span class="va">src</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">dst</span>
<span class="va">trd_dt2</span><span class="op">$</span><span class="va">dst</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">src</span>
<span class="va">trd_dt3</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">trd_dt</span>, <span class="va">trd_dt2</span><span class="op">)</span>
<span class="va">trd_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trd_dt3</span><span class="op">)</span>
<span class="va">trd_dt</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">$</span><span class="va">src</span><span class="op">)</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">trd_dt2</span>, <span class="va">trd_dt3</span><span class="op">)</span>

<span class="va">TRBD_ELC_ALL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newRepository.html">newRepository</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"TRBD_ELC_ALL"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">trd_dt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">src</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">src</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">dst</span> <span class="op">&lt;-</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">dst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">trd_nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"TRBD_ELC_"</span>, <span class="va">src</span>, <span class="st">"_"</span>, <span class="va">dst</span><span class="op">)</span> <span class="co"># Trade object name</span>
  <span class="va">cmd_nm</span> <span class="op">&lt;-</span> <span class="st">"ELC"</span>
  <span class="co"># Trade class for every route</span>
  <span class="va">trd</span> <span class="op">&lt;-</span> <span class="fu">newTrade</span><span class="op">(</span><span class="va">trd_nm</span>,
    commodity <span class="op">=</span> <span class="va">cmd_nm</span>,
    source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">src</span>, <span class="va">dst</span><span class="op">)</span>,
    destination <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">src</span>, <span class="va">dst</span><span class="op">)</span>,
    trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      src <span class="op">=</span> <span class="va">src</span>,
      dst <span class="op">=</span> <span class="va">dst</span>,
      ava.up <span class="op">=</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"GWh"</span>, <span class="st">"PJ"</span>, <span class="fl">1000</span><span class="op">)</span>, <span class="co"># Maximum capacity per route in GW</span>
      teff <span class="op">=</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">teff</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="co"># trade losses</span>
      <span class="co"># cost = trd_dt$cost[i]  # trade costs</span>
      <span class="co"># markup = trd_dt$cost[ii] # and/or markup</span>
    <span class="op">)</span>,
    <span class="co"># !!! New stuff - testing</span>
    capacityVariable <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># The trade route has capacity (not just flow) and can be endogenous</span>
    <span class="co"># bidirectional = TRUE, #</span>
    invcost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      region <span class="op">=</span> <span class="va">src</span>,
      <span class="co"># dst = dst,</span>
      year <span class="op">=</span> <span class="fl">2010</span>,
      invcost <span class="op">=</span> <span class="va">trd_dt</span><span class="op">$</span><span class="va">distance_km</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="fl">1e3</span> <span class="op">*</span> <span class="fl">250</span> <span class="co"># Assuming $250 MUSD/1000km</span>
    <span class="op">)</span>,
    <span class="co"># olife = data.frame(</span>
    olife <span class="op">=</span> <span class="fl">80</span>,
    <span class="co"># ),</span>
    cap2act <span class="op">=</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"GWh"</span>, <span class="st">"PJ"</span>, <span class="fl">24</span> <span class="op">*</span> <span class="fl">365</span><span class="op">)</span>
  <span class="op">)</span>

  <span class="va">TRBD_ELC_ALL</span> <span class="op">&lt;-</span> <span class="fu">add</span><span class="op">(</span><span class="va">TRBD_ELC_ALL</span>, <span class="va">trd</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">TRBD_ELC_ALL</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>
<span class="va">TRBD_ELC_ALL</span><span class="op">@</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
</div>
</div>
<div id="global-trade" class="section level2">
<h2 class="hasAnchor">
<a href="#global-trade" class="anchor"></a>Global trade</h2>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">COAIMP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newImport.html">newImport</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"COAIMP"</span>,
  description <span class="op">=</span> <span class="st">"Coal import from ROW"</span>,
  commodity <span class="op">=</span> <span class="st">"COA"</span>,
  imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># Let's make it a bit more expensive than domestic coal</span>
    year <span class="op">=</span> <span class="va">SUP_COA</span><span class="op">@</span><span class="va">availability</span><span class="op">$</span><span class="va">year</span>,
    price <span class="op">=</span> <span class="va">SUP_COA</span><span class="op">@</span><span class="va">availability</span><span class="op">$</span><span class="va">cost</span> <span class="op">*</span> <span class="fl">1.2</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">GASIMP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newImport.html">newImport</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"GASIMP"</span>,
  description <span class="op">=</span> <span class="st">"Natural gas import from ROW"</span>,
  commodity <span class="op">=</span> <span class="st">"GAS"</span>,
  imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># Let's make it a bit more expensive than domestic coal</span>
    year <span class="op">=</span> <span class="va">SUP_GAS</span><span class="op">@</span><span class="va">availability</span><span class="op">$</span><span class="va">year</span>,
    price <span class="op">=</span> <span class="va">SUP_GAS</span><span class="op">@</span><span class="va">availability</span><span class="op">$</span><span class="va">cost</span> <span class="op">*</span> <span class="fl">1.2</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># OILIMP &lt;- newImport(</span>
<span class="co">#   name = "OILIMP",</span>
<span class="co">#   description = "Oil import from ROW",</span>
<span class="co">#   commodity = "OIL",</span>
<span class="co">#   imp = list(</span>
<span class="co">#     # Let's make it a bit more expensive than domestic coal</span>
<span class="co">#     year = SUP_OIL@availability$year,</span>
<span class="co">#     price = SUP_OIL@availability$cost * 1.2</span>
<span class="co">#   )</span>
<span class="co"># )</span></code></pre></div>
</div>
<div id="the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-model" class="anchor"></a>The model</h2>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reps</span> <span class="op">&lt;-</span> <span class="fu">add</span><span class="op">(</span>
  <span class="fu"><a href="../reference/newRepository.html">newRepository</a></span><span class="op">(</span><span class="st">"utopia_repository"</span><span class="op">)</span>,
  <span class="co"># Commodities</span>
  <span class="va">ELC</span>, <span class="co"># electricity</span>
  <span class="va">COA</span>, <span class="va">GAS</span>, <span class="va">NUC</span>, <span class="va">HYD</span>, <span class="va">BIO</span>, <span class="co"># energy</span>
  <span class="va">WIN</span>, <span class="va">SOL</span>, <span class="co"># renewables</span>
  <span class="va">CO2</span>, <span class="va">PM</span>, <span class="va">NOX</span>, <span class="va">SO2</span>, <span class="va">HG</span>, <span class="va">CH4</span>, <span class="co"># emissions</span>
  <span class="co"># Supply</span>
  <span class="va">SUP_NUC</span>, <span class="va">SUP_COA</span>, <span class="va">SUP_GAS</span>, <span class="va">RES_HYD</span>,
  <span class="va">RES_SOL</span>, <span class="va">RES_WIN</span>,
  <span class="co"># Import from ROW</span>
  <span class="va">COAIMP</span>, <span class="va">GASIMP</span>,
  <span class="co"># Technologies</span>
  <span class="va">ECOA</span>, <span class="va">EGAS</span>, <span class="va">ENUC</span>, <span class="va">EHYD</span>,
  <span class="co"># EWIN, ESOL,</span>
  <span class="co"># Electricity trade</span>
  <span class="co"># TRD_ELC_ALL, # repository with electricity trade routes</span>
  <span class="va">DEM_ELC</span> <span class="co"># ELC demand with load curve (24 hours x 12 months)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">reps</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">reps</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>

<span class="va">mdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newModel.html">newModel</a></span><span class="op">(</span><span class="st">"UTOPIA"</span>,
  debug <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span> <span class="co"># comm = "ELC",</span>
    dummyImport <span class="op">=</span> <span class="fl">1e6</span>,
    dummyExport <span class="op">=</span> <span class="fl">1e6</span>
  <span class="op">)</span>,
  region <span class="op">=</span> <span class="va">reg_names</span>,
  discount <span class="op">=</span> <span class="fl">0.05</span>,
  slice <span class="op">=</span> <span class="va">timeslices</span>,
  <span class="co"># slice = unlist(timeslices2),</span>
  repository <span class="op">=</span> <span class="va">reps</span>,
  <span class="co"># GIS = gis,</span>
  early.retirement <span class="op">=</span> <span class="cn">F</span>
<span class="op">)</span></code></pre></div>
<p>We can check the shares of the time-slices which are auto-calculated assuming that all slices have the same weights. This works for 24 hours, but the weights for every month can be specified to take the difference in months length.</p>
<table class="table">
<thead><tr class="header">
<th align="left">ANNUAL</th>
<th align="left">MONTH</th>
<th align="left">HOUR</th>
<th align="right">share</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ANNUAL</td>
<td align="left">W</td>
<td align="left">D</td>
<td align="right">0.0937500</td>
</tr>
<tr class="even">
<td align="left">ANNUAL</td>
<td align="left">W</td>
<td align="left">N</td>
<td align="right">0.1250000</td>
</tr>
<tr class="odd">
<td align="left">ANNUAL</td>
<td align="left">W</td>
<td align="left">P</td>
<td align="right">0.0312500</td>
</tr>
<tr class="even">
<td align="left">ANNUAL</td>
<td align="left">R</td>
<td align="left">D</td>
<td align="right">0.1145833</td>
</tr>
<tr class="odd">
<td align="left">ANNUAL</td>
<td align="left">R</td>
<td align="left">N</td>
<td align="right">0.1145833</td>
</tr>
<tr class="even">
<td align="left">ANNUAL</td>
<td align="left">R</td>
<td align="left">P</td>
<td align="right">0.0208333</td>
</tr>
<tr class="odd">
<td align="left">ANNUAL</td>
<td align="left">S</td>
<td align="left">D</td>
<td align="right">0.1250000</td>
</tr>
<tr class="even">
<td align="left">ANNUAL</td>
<td align="left">S</td>
<td align="left">N</td>
<td align="right">0.0937500</td>
</tr>
<tr class="odd">
<td align="left">ANNUAL</td>
<td align="left">S</td>
<td align="left">P</td>
<td align="right">0.0312500</td>
</tr>
<tr class="even">
<td align="left">ANNUAL</td>
<td align="left">A</td>
<td align="left">D</td>
<td align="right">0.1145833</td>
</tr>
<tr class="odd">
<td align="left">ANNUAL</td>
<td align="left">A</td>
<td align="left">N</td>
<td align="right">0.1145833</td>
</tr>
<tr class="even">
<td align="left">ANNUAL</td>
<td align="left">A</td>
<td align="left">P</td>
<td align="right">0.0208333</td>
</tr>
</tbody>
</table>
<div id="the-model-horizon-and-annual-time-steps-milesone-years" class="section level3">
<h3 class="hasAnchor">
<a href="#the-model-horizon-and-annual-time-steps-milesone-years" class="anchor"></a>The model horizon and annual time-steps (<code>milesone years</code>)</h3>
<p>If we don’t need year-by-year steps, milestone years (MSY) can be specifyed to reduce the model dimention. The function <code>setMilestoneYears</code> takes as arguments the model start year and the intervals between MSYs, and calculates the interval years (start and end) for each milestone year.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdl</span> <span class="op">&lt;-</span> <span class="fu">setMilestoneYears</span><span class="op">(</span><span class="va">mdl</span>, start <span class="op">=</span> <span class="fl">2015</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">mdl</span><span class="op">@</span><span class="va">sysInfo</span><span class="op">@</span><span class="va">milestone</span></code></pre></div>
</div>
</div>
</div>
<div id="scenarios" class="section level1">
<h1 class="hasAnchor">
<a href="#scenarios" class="anchor"></a>Scenarios</h1>
<div id="base-traditional-techs-no-trade" class="section level2">
<h2 class="hasAnchor">
<a href="#base-traditional-techs-no-trade" class="anchor"></a>“BASE”: traditional techs, no trade</h2>
</div>
<div id="grid-traditional-techs-and-interregional-trade" class="section level2">
<h2 class="hasAnchor">
<a href="#grid-traditional-techs-and-interregional-trade" class="anchor"></a>“GRID”: traditional techs and interregional trade</h2>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">scen_GRID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="fu">add</span><span class="op">(</span><span class="va">mdl</span>, <span class="va">TRBD_ELC_ALL</span><span class="op">)</span>, <span class="co"># Adding trade routes</span>
  name <span class="op">=</span> <span class="st">"GRID"</span>,
  <span class="co"># tmp.path = "C:/solwork",</span>
  solver <span class="op">=</span> <span class="va">mysolver</span>,
  tmp.name <span class="op">=</span> <span class="st">"UTOPIA_GRID"</span>,
  tmp.del <span class="op">=</span> <span class="cn">F</span>,
  trim <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">scen_GRID</span><span class="op">)</span></code></pre></div>
</div>
<div id="rbau-traditional-techs-and-interregional-trade" class="section level2">
<h2 class="hasAnchor">
<a href="#rbau-traditional-techs-and-interregional-trade" class="anchor"></a>“RBAU”: traditional techs and interregional trade</h2>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">scen_RBAU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="fu">add</span><span class="op">(</span><span class="va">mdl</span>, <span class="va">TRBD_ELC_ALL</span>, <span class="va">WWIN</span>, <span class="va">WSOL</span>, <span class="va">EWIN</span>, <span class="va">ESOL</span>, <span class="va">STGELC</span><span class="op">)</span>, <span class="co">#</span>
  name <span class="op">=</span> <span class="st">"RBAU"</span>,
  description <span class="op">=</span> <span class="st">"Adding renewables"</span>,
  <span class="co"># tmp.path = "C:/solwork",</span>
  solver <span class="op">=</span> <span class="va">mysolver</span>,
  <span class="co"># solver = "GLPK",</span>
  <span class="co"># solver = "GAMS",</span>
  tmp.name <span class="op">=</span> <span class="st">"UTOPIA_REN"</span>,
  tmp.del <span class="op">=</span> <span class="cn">F</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">scen_RBAU</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="quick-look-at-the-results" class="section level1">
<h1 class="hasAnchor">
<a href="#quick-look-at-the-results" class="anchor"></a>Quick look at the results</h1>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># scen &lt;- scen_BASE</span>
<span class="va">scen</span> <span class="op">&lt;-</span> <span class="va">scen_RBAU</span>

<span class="co"># Quick check</span>
<span class="va">scen</span><span class="op">@</span><span class="va">modOut</span><span class="op">@</span><span class="va">variables</span><span class="op">$</span><span class="va">vObjective</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">scen</span><span class="op">)</span></code></pre></div>
<div id="getdata-function" class="section level2">
<h2 class="hasAnchor">
<a href="#getdata-function" class="anchor"></a><code>getData</code> function</h2>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">scen_BASE</span>, <span class="va">scen_GRID</span>, <span class="va">scen_RBAU</span><span class="op">)</span>

<span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span><span class="va">sns</span>, name <span class="op">=</span> <span class="st">"vObjective"</span>, merge <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span><span class="va">scen_BASE</span>, name <span class="op">=</span> <span class="st">"vTechOutTot"</span>, comm <span class="op">=</span> <span class="st">"ELC"</span>, merge <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span><span class="va">sns</span>, name <span class="op">=</span> <span class="st">"vTechOutTot"</span>, comm <span class="op">=</span> <span class="st">"ELC"</span>, merge <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
</div>
<div id="pivot-tables" class="section level2">
<h2 class="hasAnchor">
<a href="#pivot-tables" class="anchor"></a>Pivot tables</h2>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># getData format</span>
<span class="fu"><a href="../reference/pivot.html">pivot</a></span><span class="op">(</span><span class="va">sns</span>, comm <span class="op">=</span> <span class="st">"ELC"</span>, name <span class="op">=</span> <span class="st">"vTechOut"</span><span class="op">)</span></code></pre></div>
</div>
<div id="some-figures" class="section level2">
<h2 class="hasAnchor">
<a href="#some-figures" class="anchor"></a>Some figures</h2>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elc_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span><span class="va">sns</span>, name <span class="op">=</span> <span class="st">"vTechOutTot"</span>, comm <span class="op">=</span> <span class="st">"ELC"</span>, merge <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">elc_out</span>
<span class="va">elc_out</span> <span class="op">&lt;-</span> <span class="va">elc_out</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">comm</span>, <span class="va">year</span>, <span class="va">region</span>, <span class="va">scenario</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>GWh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"PJ"</span>, <span class="st">"GWh"</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">elc_out</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">GWh</span>, colour <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">region</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">elc_out</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">GWh</span>, colour <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">scenario</span><span class="op">)</span>

<span class="va">emis</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span><span class="va">sns</span>,
    name <span class="op">=</span> <span class="st">"vBalance"</span>, merge <span class="op">=</span> <span class="cn">T</span>,
    comm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NOX"</span>, <span class="st">"SO2"</span>, <span class="st">"PM"</span>, <span class="st">"HG"</span>, <span class="st">"CO2"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">scenario</span>, <span class="va">comm</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">emis</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">value</span>, colour <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">comm</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span>


<span class="co"># Fuel Mix</span>

<span class="va">vTechInp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span><span class="va">sns</span>, name <span class="op">=</span> <span class="st">"vTechInp"</span>, tech_ <span class="op">=</span> <span class="st">"^E"</span>, merge <span class="op">=</span> <span class="cn">T</span>, yearsAsFactors <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">vTechInp</span><span class="op">$</span><span class="va">tech</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">vTechInp</span><span class="op">$</span><span class="va">comm</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">vTechInp</span><span class="op">$</span><span class="va">scenario</span><span class="op">)</span>

<span class="va">fumx</span> <span class="op">&lt;-</span> <span class="va">vTechInp</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">scenario</span>, <span class="va">comm</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>PJ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
<span class="va">fumx</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">fumx</span>, <span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">PJ</span>, fill <span class="op">=</span> <span class="va">comm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, fill <span class="op">=</span> <span class="st">"Fuel"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">scenario</span><span class="op">)</span>

<span class="co"># The same by regions</span>
<span class="va">fumxr</span> <span class="op">&lt;-</span> <span class="va">vTechInp</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">scenario</span>, <span class="va">region</span>, <span class="va">comm</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>PJ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fumxr</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">fumxr</span>, <span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">PJ</span>, fill <span class="op">=</span> <span class="va">comm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, fill <span class="op">=</span> <span class="st">"Fuel"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">region</span> <span class="op">~</span> <span class="va">scenario</span><span class="op">)</span></code></pre></div>
<div id="trade-1" class="section level3">
<h3 class="hasAnchor">
<a href="#trade-1" class="anchor"></a>Trade</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Names of all unempty variables and parameters for trade</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span><span class="va">scen</span>, name_ <span class="op">=</span> <span class="st">"trd|trade|Trade"</span>, merge <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Capacity of the trade routes (the Grid)</span>
<span class="va">trd_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span><span class="va">scen</span>,
  name <span class="op">=</span> <span class="st">"vTradeCap"</span>, merge <span class="op">=</span> <span class="cn">T</span>,
  newNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"value"</span> <span class="op">=</span> <span class="st">"GW"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">trd_cap</span>

<span class="va">trd_cap</span><span class="op">$</span><span class="va">src</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">trd_cap</span><span class="op">$</span><span class="va">trade</span>, <span class="st">"_"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="va">trd_cap</span><span class="op">$</span><span class="va">dst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">trd_cap</span><span class="op">$</span><span class="va">trade</span>, <span class="st">"_"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Adding location information for regions' centers</span>
<span class="va">trd_cap</span> <span class="op">&lt;-</span> <span class="va">trd_cap</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">reg_centers</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"src"</span> <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">reg_centers</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dst"</span> <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>xsrc <span class="op">=</span> <span class="va">x.x</span>, ysrc <span class="op">=</span> <span class="va">y.x</span>, xdst <span class="op">=</span> <span class="va">x.y</span>, ydst <span class="op">=</span> <span class="va">y.y</span><span class="op">)</span>
<span class="co"># mutate(GWh = convert("PJ", "GWh", value))</span>
<span class="va">trd_cap</span>

<span class="va">ftrd_cap_map</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trd_cap</span>, <span class="va">year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trd_cap</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Function to map grid capacity for a particular year</span>
  <span class="va">ii</span> <span class="op">&lt;-</span> <span class="va">trd_cap</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">year</span>
  <span class="co"># browser()</span>
  <span class="va">trd_cap_map</span> <span class="op">&lt;-</span>
    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ggis</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_polygon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,
      fill <span class="op">=</span> <span class="st">"wheat"</span>,
      colour <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">.5</span>
    <span class="op">)</span> <span class="op">+</span> <span class="co"># aes fill = id,</span>
    <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="co"># do this to leave off the color legend</span>
    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Interregional electricity grid, year = "</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>
      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">xsrc</span>, y <span class="op">=</span> <span class="va">ysrc</span>, xend <span class="op">=</span> <span class="va">xdst</span>, yend <span class="op">=</span> <span class="va">ydst</span>, size <span class="op">=</span> <span class="va">GW</span><span class="op">)</span>,
      data <span class="op">=</span> <span class="va">trd_cap</span><span class="op">[</span><span class="va">ii</span>, <span class="op">]</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,
      alpha <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"dodgerblue"</span>, lineend <span class="op">=</span> <span class="st">"round"</span>, show.legend <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_size_area</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">trd_cap</span><span class="op">$</span><span class="va">GW</span><span class="op">)</span>, max_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">reg_centers</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
  <span class="va">trd_cap_map</span>
<span class="op">}</span>
<span class="va">yrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trd_cap</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="co"># all years</span>
<span class="fu">ftrd_cap_map</span><span class="op">(</span><span class="va">trd_cap</span>, <span class="va">yrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu">ftrd_cap_map</span><span class="op">(</span><span class="va">trd_cap</span>, <span class="va">yrs</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="fu">ftrd_cap_map</span><span class="op">(</span><span class="va">trd_cap</span>, <span class="va">yrs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">yrs</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Trade flows</span>
<span class="va">trd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span><span class="va">scen_RBAU</span>, name <span class="op">=</span> <span class="st">"vTradeIr"</span>, comm <span class="op">=</span> <span class="st">"ELC"</span>, merge <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">trd</span><span class="op">)</span>

<span class="va">trd_flo</span> <span class="op">&lt;-</span> <span class="va">trd</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">reg_centers</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"src"</span> <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">reg_centers</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dst"</span> <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>xsrc <span class="op">=</span> <span class="va">x.x</span>, ysrc <span class="op">=</span> <span class="va">y.x</span>, xdst <span class="op">=</span> <span class="va">x.y</span>, ydst <span class="op">=</span> <span class="va">y.y</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>GWh <span class="op">=</span> <span class="fu"><a href="../reference/convert.html">convert</a></span><span class="op">(</span><span class="st">"PJ"</span>, <span class="st">"GWh"</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span>

<span class="va">trd_flo</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">trd_rou</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">trd_flo</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">trd_flo</span><span class="op">$</span><span class="va">GWh</span><span class="op">)</span>

<span class="co"># ss &lt;- unique(trd_flo$slice)[1]</span>

<span class="va">ftrd_flo_map</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">slice</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trd_flo</span><span class="op">$</span><span class="va">slice</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,
                         <span class="va">year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trd_flo</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># browser()</span>
  <span class="va">ii</span> <span class="op">&lt;-</span> <span class="va">trd_flo</span><span class="op">$</span><span class="va">slice</span> <span class="op">==</span> <span class="va">slice</span>
  <span class="va">ii</span> <span class="op">&lt;-</span> <span class="va">ii</span> <span class="op">&amp;</span> <span class="va">trd_flo</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">year</span>
  <span class="va">trd_flo_map</span> <span class="op">&lt;-</span>
    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ggis</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_polygon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,
      fill <span class="op">=</span> <span class="st">"wheat"</span>,
      colour <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">.5</span>
    <span class="op">)</span> <span class="op">+</span> <span class="co"># aes fill = id,</span>
    <span class="fu">coord_fixed</span><span class="op">(</span><span class="fl">1.</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="co"># do this to leave off the color legend</span>
    <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
      <span class="st">"Interregional electricity trade flows, year = "</span>,
      <span class="va">year</span>, <span class="st">", slice = "</span>, <span class="va">slice</span>
    <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>
      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">xsrc</span>, y <span class="op">=</span> <span class="va">ysrc</span>, xend <span class="op">=</span> <span class="va">xdst</span>, yend <span class="op">=</span> <span class="va">ydst</span>, size <span class="op">=</span> <span class="va">GWh</span><span class="op">)</span>,
      data <span class="op">=</span> <span class="va">trd_flo</span><span class="op">[</span><span class="va">ii</span>, <span class="op">]</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,
      alpha <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"dodgerblue"</span>, lineend <span class="op">=</span> <span class="st">"round"</span>, show.legend <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_size_area</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">trd_flo</span><span class="op">$</span><span class="va">GWh</span><span class="op">)</span>, max_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">reg_centers</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">xsrc</span>, y <span class="op">=</span> <span class="va">ysrc</span>, xend <span class="op">=</span> <span class="va">xdst</span>, yend <span class="op">=</span> <span class="va">ydst</span><span class="op">)</span>,
      data <span class="op">=</span> <span class="va">trd_flo</span><span class="op">[</span><span class="va">ii</span>, <span class="op">]</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, size <span class="op">=</span> <span class="fl">.1</span>,
      arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>
        type <span class="op">=</span> <span class="st">"closed"</span>, angle <span class="op">=</span> <span class="fl">15</span>,
        length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"inches"</span><span class="op">)</span>
      <span class="op">)</span>,
      colour <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>,
      lineend <span class="op">=</span> <span class="st">"butt"</span>, linejoin <span class="op">=</span> <span class="st">"mitre"</span>, show.legend <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span> <span class="co"># , name = "Trade, PJ"</span>
  <span class="va">trd_flo_map</span>
<span class="op">}</span>
<span class="fu">ftrd_flo_map</span><span class="op">(</span><span class="op">)</span>
<span class="fu">ftrd_flo_map</span><span class="op">(</span><span class="op">)</span>

<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"homedir"</span><span class="op">)</span><span class="op">)</span> <span class="va">homedir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This step requires LaTeX installed, as well as 'animation' package</span>
<span class="co"># install.packages("animation")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.name/animation">animation</a></span><span class="op">)</span>

<span class="co"># A temporary directory for figures</span>
<span class="va">figpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">homedir</span>, <span class="st">"tmp/fig"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="va">figpath</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">figpath</span>, recursive <span class="op">=</span> <span class="cn">T</span>, showWarnings <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"homedir"</span><span class="op">)</span><span class="op">)</span> <span class="va">homedir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">figpath</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/animation/man/saveLatex.html">saveLatex</a></span><span class="op">(</span>
  <span class="op">{</span>
    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="va">slc</span><span class="op">$</span><span class="va">slice</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu">ftrd_flo_map</span><span class="op">(</span><span class="va">s</span>, year <span class="op">=</span> <span class="fl">2055</span><span class="op">)</span>
      <span class="fu">ggsave</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Rplot"</span>, <span class="va">n</span>, <span class="st">".pdf"</span><span class="op">)</span>, device <span class="op">=</span> <span class="st">"pdf"</span><span class="op">)</span>
      <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="op">}</span>
  <span class="op">}</span>,
  use.dev <span class="op">=</span> <span class="cn">FALSE</span>,
  caption <span class="op">=</span> <span class="st">"Electricity generation and inter-regional trade."</span>,
  <span class="co"># label = "blablabla",</span>
  ani.dev <span class="op">=</span> <span class="st">"pdf"</span>,
  ani.type <span class="op">=</span> <span class="st">"pdf"</span>,
  img.fmt <span class="op">=</span> <span class="st">"Rplot%d.pdf"</span>,
  ani.width <span class="op">=</span> <span class="fl">8</span>,
  ani.height <span class="op">=</span> <span class="fl">10.5</span>,
  <span class="co"># documentclass = docclass,</span>
  verbose <span class="op">=</span> <span class="cn">T</span>
  <span class="co"># latex.filename = fname #label = h,</span>
  <span class="co"># pdflatex = NULL</span>
  <span class="co"># caption = tsdh2datetime(h)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">homedir</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">figpath2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">homedir</span>, <span class="st">"tmp/fig2"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="va">figpath2</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">figpath2</span>, recursive <span class="op">=</span> <span class="cn">T</span>, showWarnings <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"homedir"</span><span class="op">)</span><span class="op">)</span> <span class="va">homedir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">figpath2</span><span class="op">)</span>

<span class="co"># Figures output parameters</span>
<span class="va">scl1</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">dpi</span> <span class="op">&lt;-</span> <span class="fl">160</span> <span class="op">*</span> <span class="va">scl1</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="va">mdl</span><span class="op">@</span><span class="va">sysInfo</span><span class="op">@</span><span class="va">milestone</span><span class="op">$</span><span class="va">mid</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="va">slc</span><span class="op">$</span><span class="va">slice</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Rplot"</span>, <span class="va">n</span>, <span class="st">".png"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">" "</span>, <span class="va">s</span>, <span class="st">" "</span>, <span class="va">fname</span>, <span class="st">"\n"</span><span class="op">)</span>
    <span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu">ftrd_flo_map</span><span class="op">(</span><span class="va">s</span>, year <span class="op">=</span> <span class="va">y</span><span class="op">)</span>
    <span class="fu">ggsave</span><span class="op">(</span><span class="va">fname</span>, <span class="va">pp</span>,
      device <span class="op">=</span> <span class="st">"png"</span>,
      dpi <span class="op">=</span> <span class="va">dpi</span>, width <span class="op">=</span> <span class="va">scl1</span> <span class="op">*</span> <span class="fl">1920</span> <span class="op">/</span> <span class="va">dpi</span>, height <span class="op">=</span> <span class="va">scl1</span> <span class="op">*</span> <span class="fl">1080</span> <span class="op">/</span> <span class="va">dpi</span>
    <span class="op">)</span>
    <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># Download and unpack ffmpeg (https://www.ffmpeg.org/) on your computer</span>
<span class="co"># correct the path below</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"c:/utils/ffmpeg/bin/ffmpeg -r 4 -f image2 -s 1920x1080 -i Rplot%d.png -vcodec libx264 -crf 25 -pix_fmt yuv420p -y utopia_example_trade.mp4"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">homedir</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="scenarios-with-constraints" class="section level1">
<h1 class="hasAnchor">
<a href="#scenarios-with-constraints" class="anchor"></a>Scenarios with constraints</h1>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## NXSX: NOX and SO2 control</span>
<span class="va">NOXSO2control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newConstraint.html">newConstraint</a></span><span class="op">(</span>
  <span class="st">"NOXSO2control"</span>,
  eq <span class="op">=</span> <span class="st">"&lt;="</span>,
  rhs <span class="op">=</span> <span class="fl">1e6</span>,
  for.each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>year <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,
  variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    variable <span class="op">=</span> <span class="st">"vOutTot"</span>,
    for.sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>comm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NOX"</span>, <span class="st">"SO2"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">NOXSO2controlMult</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newConstraint.html">newConstraint</a></span><span class="op">(</span>
  <span class="st">"NOXSO2control"</span>,
  eq <span class="op">=</span> <span class="st">"&lt;="</span>,
  rhs <span class="op">=</span> <span class="fl">1e6</span>,
  for.each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>year <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,
  variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    variable <span class="op">=</span> <span class="st">"vOutTot"</span>,
    for.sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>comm <span class="op">=</span> <span class="st">"NOX"</span><span class="op">)</span>,
    mult <span class="op">=</span> <span class="fl">1.5</span>
  <span class="op">)</span>,
  <span class="co"># for the case of different multipliers</span>
  variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    variable <span class="op">=</span> <span class="st">"vOutTot"</span>,
    for.sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>comm <span class="op">=</span> <span class="st">"SO2"</span><span class="op">)</span>,
    mult <span class="op">=</span> <span class="fl">1.25</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">NOXSO2controlCum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newConstraint.html">newConstraint</a></span><span class="op">(</span>
  <span class="st">"NOXSO2control"</span>,
  eq <span class="op">=</span> <span class="st">"&lt;="</span>,
  rhs <span class="op">=</span> <span class="fl">1e8</span>,
  variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    variable <span class="op">=</span> <span class="st">"vOutTot"</span>,
    for.sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      comm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NOX"</span>, <span class="st">"SO2"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div id="ghg50-cap-and-trade" class="section level2">
<h2 class="hasAnchor">
<a href="#ghg50-cap-and-trade" class="anchor"></a>GHG50: Cap and trade</h2>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">GHG50tax</span> <span class="op">&lt;-</span> <span class="fu">newTax</span><span class="op">(</span><span class="st">"GHGtax"</span>, comm <span class="op">=</span> <span class="st">"GHG"</span>, tax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bal <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span>

<span class="co"># GHG50tax &lt;- newTax('HGtax', comm = 'HG', year = 2025:2035, value = data.frame(year = c(2025, 2030), value = c(1, 100)))</span>

<span class="va">GHG50CapTrade</span> <span class="op">&lt;-</span> <span class="fu">add</span><span class="op">(</span>
  <span class="fu"><a href="../reference/newRepository.html">newRepository</a></span><span class="op">(</span><span class="st">"GHG50CapTrade"</span><span class="op">)</span>,
  <span class="co"># Aggregate HG</span>
  <span class="fu"><a href="../reference/newCommodity.html">newCommodity</a></span><span class="op">(</span><span class="st">"GHGtrade"</span><span class="op">)</span>, <span class="co"># Commodity to take to account trade</span>
  <span class="co"># Equation that provide quote mechanisme</span>
  <span class="fu"><a href="../reference/newConstraint.html">newConstraint</a></span><span class="op">(</span><span class="st">"GHGcap"</span>,
    eq <span class="op">=</span> <span class="st">"&lt;="</span>, rhs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2055</span><span class="op">)</span>, rhs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1e8</span>, <span class="fl">1e3</span><span class="op">)</span><span class="op">)</span>,
    for.each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>year <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>, <span class="co"># Cap total emission</span>
    variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"vOutTot"</span>, for.sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>comm <span class="op">=</span> <span class="st">"HG"</span><span class="op">)</span><span class="op">)</span>,
    variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"vOutTot"</span>, for.sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>comm <span class="op">=</span> <span class="st">"HGtrade"</span><span class="op">)</span>, mult <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
  <span class="op">)</span>,
  <span class="fu">newTax</span><span class="op">(</span><span class="st">"GHGtax"</span>, comm <span class="op">=</span> <span class="st">"HGtrade"</span>, tax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bal <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="co"># Cost of quote</span>
<span class="op">)</span></code></pre></div>
<p>tbc…</p>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>…</p>
<div style="page-break-after: always;"></div>
</div>
<div id="appendix-energyrt-variables-and-parameters-" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix-energyrt-variables-and-parameters-" class="anchor"></a>Appendix: <strong>energyRt</strong> variables and parameters.</h1>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Oleg Lugovoy, Vladimir Potashnikov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
